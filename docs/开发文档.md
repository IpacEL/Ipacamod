## 开发者文档












<details><summary>网络不稳定</summary>

```
收录时间: 2022年8月3日. 运营商: 新疆广电, 城市: 乌鲁木齐市. 游戏延迟: 460ms. 客户端: 基岩版(1.19), 服务器版本: 8252. 
```

</details>



















<details><summary>注意玩家</summary>

### 恶意宣传
恶意宣传服务器到其他服务器群
常见流程: 
```
很简单, 开几个 (或者买几个) qq号, 添加一堆服务器群, 藏几天然后发一大堆宣传链接和文字即可
并且受害方说不清, 如果再整几个假服务器做视频发网上, 服务器差不多就没了
不仅会有人来破坏服务器群, 还会有人直接破坏服务器
不需要去添加那些高门槛的服务器群, 因为那里面的人不容易整事
```

From-pErfo 的解决方案: 
```
一个比较简单的方法是准备严格的白名单审核机制和与内群完全隔离的外群 (审核群
一般会做这些破坏的人没有很多耐心. 然后保护好服务器的ip地址, 以及防止内鬼
```


</details>














<details><summary>领地文档 [已弃用]</summary>

## 领地
领地是平面化的, 创建领地时不需要设置高度.  


### 编辑工具和说明
用于创建/修改领地, 和创建领地的要求说明.  

#### 金铲子: 用于创建和编辑领地
创建: 使用此工具在地图上选择一个点, 再点击对角的点, 最后点击第一次选择的点即可完成创建.  
编辑: 在其中一个点重新扩大或缩小领地[可能需要选取].  

#### 木棍: 用于选取领地或检查指定位置是否有领地
检测/选取: 右键单击.  

#### 说明
领地方块: 决定您能创建多大的领地.  
	获取: 正常上线每小时可获得40领地方块, 最多可持有65536领地方块[256*256].  
	检查: 手持金铲子自动提示领地方块数量.  

### 创建和修改
创建: 单个领地的最小边长为5格, 最小面积不少于50格.  
扩大/缩小: 是用金铲子选择领地的一个角进行编辑.  
删除领地, 站在选取的领地中使用, 不退回领地方块, 不影响领地方块上限.  

```
/fl	#列出领地位置
/fdel	#删除选中领地
```

### 子领地
子领地的创建没有限制, 但可选范围被限制在主领地内.  
创建方法与主领地相同, 并且可以单独为每个子领地分配权限.  

```
/fs	# 切换为子领地模式, 切换物品即可关闭
```

### 共享领地
可以将一个领地按不同权限共享给其他玩家.  

```
/fpl	# 列出此领地已分配权限的玩家
/fp1 <玩家>	# 给予玩家[使用门/拉杆等]的权限
/fp2 <玩家>	# 给予玩家[以上和 使用箱子/击杀生物等]的权限
/fp3 <玩家>	# 给予玩家[以上和 建造/使用实体等]的权限
/fp4 <玩家>	# 给予玩家领地管理权限[对方仅可以使用领地管理指令, 不包含以上权限]

/fpdel <玩家>	# 撤销此领地中一位玩家的权限
/fpdelall	# 撤销此领地中所有玩家的权限
```


### 领地属性

```
/fpboom	# 临时开启或关闭一个领地的爆炸保护
```

</details>














<details><summary>文档查看器</summary>

### 安装

1. 新建一个目录用于存放文档和文档网页
```
Range
├─ docs
│    ├─ img
│    ├─ 文档1.md
│    └─ 文档2.md
├─ index.html
└─ plugins
       ├─ Range.css
       └─ Range.js
```

2. 将文档标题和已有的 .md 文件填入 index.html 页面的文档目录数组
```
<!-- 文档目录 -->
<div id="list" class="list box"
	data-docList='[
		"<h3>文档标题</h3>",
		"文档1.md",
		"文档2.md",
		""
	]'>
</div>
```

3. 访问 `Range/index.html` 查看文档


### 更新文档
客户端通常会缓存 .md 文件, 导致新的文档不能立即显示, 这里将列举两种方式用于更新文档.  

#### 通过 NGINX 配置协商缓存 [推荐]
配置完成后客户端将发送已缓存的文档版本, 服务器进行比较, 若有更新则发送新的文档, 否则使用客户端的缓存.  
Ipacamod 的文档使用这种方法更新, 所以不需要修改版本号.  
```
server{
	# 协商缓存
	location ~ \.(html|md)$ {
		# 要求浏览器发送If-Modified-Since请求头
		add_header	Cache-Control	no-cache;
		autoindex	on;
	}
}
```

#### 修改 index.html 中的目录数组
在文档文件后添加 `?v=<版本号>`, 当客户端重新加载 index.html 时会请求新的文档.  
这种方式适用于长期不修改的文档, 因为客户端会缓存不同版本的文件, 浪费存储空间.  
```
<!-- 文档目录 -->
<div id="list" class="list box"
	data-docList='[
		"<h3>文档标题</h3>",
		"文档1.md?v=1.0.1",
		"文档2.md",
		""
	]'>
</div>
```

</details>












<details><summary>Spigot/Paper 常用参数</summary>

```
--world-dir <worlds>	# 将地图放在此目录下
--nogui	# 关闭GUI
```

</details>













<details><summary>Ipacamod 的MC服务器启动参数</summary>

#### 参考文档: 
https://wiki.openjdk.org/display/shenandoah/Main
2019.12基准报告: https://ionutbalosin.com/2019/12/jvm-garbage-collectors-benchmarks-report-19-12/
2020.1性能调优指南: https://ionutbalosin.com/2020/01/hotspot-jvm-performance-tuning-guidelines/
搜索引擎, 以及各种文章: https://cn.bing.com/

#### 参考实例: 
SGC: https://github.com/hilltty/hilltty-flags
aikar-G1GC: https://aikar.co/mcflags.html
etil-G1GC-new: https://github.com/etil2jz/etil-minecraft-flags
VeroFess-ZGC: https://blog.binklac.com/e6ad4dc21152/
GraalVM-G1GC: https://github.com/brucethemoose/Minecraft-Performance-Flags-Benchmarks

#### 以及: 
`-XX:+PrintFlagsFinal`: 打印此Java的所有参数
`Nm70727, From-pErfo`: 一个坚持了4年的MC服主!

---
### 成果和草稿
我将此参数配合 dragonwell17 使用, 如果使用 dragonwell11 可添加 Wisp2 以获得据说最多10倍的性能提升. 不过 dragonwell 的重心不在 dragonwell17 中, 或许使用 Zulu/GraalVM 是更好的选择. 

参数及说明: 
```
-server	# 这在JDK中是默认的, 只是习惯性放在这里
-Xms16G -Xmx16G	# 预计分配的内存大小
-XX:+UnlockExperimentalVMOptions	# 启用实验选项
```

```
-XX:+UseShenandoahGC		# 启用SGC
-XX:ShenandoahGCMode=iu	# SGC模式 [实验选项] 

-XX:+AlwaysPreTouch		# 分配连续的内存并在启动时保留
-XX:+UseLargePages		# 启用大页面内存
[LINUX] -XX:LargePageSizeInBytes=1G		# 内存分页 1G
[LINUX] -XX: UseTransparentHugePages		# 透明大页面
-XX:+PerfDisableSharedMem		# 将匿名内存用于性能计数器

```

```
-XX:+ParallelRefProcEnabled		# 尽可能启用并行引用处理 缓存
-XX:+DisableExplicitGC		# 忽略代码中的 System.gc() 调用 防止插件调用GC
[需要系统支持] -XX:+UseNUMA		# NUMA [测试]
-XX:ReservedCodeCacheSize=512M		# 代码缓存大小
-XX:MaxInlineSize=256 方法内联条件		# 小于此值进行内联
-XX:+SegmentedCodeCache		# 使用分段的代码缓存区
-XX:-DontCompileHugeMethods	# 允许大方法被JIT编译
[!] -XX:+OmitStackTraceInFastThrow	# 在快速抛出中省略堆栈跟踪
-XX:ThreadPriorityPolicy=1	# 允许提高线程优先级
[!] -XX:+TrustFinalNonStaticFields	# 信任常量折叠的最终非静态声明
-XX:+UseFastUnorderedTimeStamps	# 快速无序时间戳
-XX:+UseXmmI2D -XX:+UseXmmI2F	# ?
-XX:UseAVX=3	# ? 不支持时会设置为2

--add-modules=jdk.incubator.vector

# CPU相关的快速指令
-XX:+UseVectorCmov -XX:+UseNewLongLShift -XX:+UseFastStosb
# -XX:+UseFMA -XX:+UseSHM # 不支持
```

临时: 
```
# -XX:+UseNUMAInterleaving	# 在不支持完整NUMA的系统上提供该子集
# -XX:CompileThreshold=500	# 使用C2编译的阈值

# jconsole
-Djava.rmi.server.hostname=0.0.0.0 -Dcom.sun.management.jmxremote.port=2777 -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.ssl=false -Dspring.profiles.active=ci
```

启动参数: `发布版本2_beta1, 2022年8月13日更新`
```
-server -Xms16G -Xmx16G -XX:+UnlockExperimentalVMOptions -XX:+UseShenandoahGC -XX:ShenandoahGCMode=iu -XX:+AlwaysPreTouch -XX:+UseLargePages -XX:+PerfDisableSharedMem -XX:+ParallelRefProcEnabled -XX:+DisableExplicitGC -XX:+UseNUMA -XX:ReservedCodeCacheSize=512M -XX:MaxInlineSize=256 -XX:+SegmentedCodeCache -XX:-DontCompileHugeMethods -XX:+OmitStackTraceInFastThrow -XX:ThreadPriorityPolicy=1 -XX:+TrustFinalNonStaticFields -XX:+UseFastUnorderedTimeStamps -XX:+UseXmmI2D -XX:+UseXmmI2F -XX:UseAVX=3 --add-modules=jdk.incubator.vector -XX:+UseVectorCmov -XX:+UseNewLongLShift -XX:+UseFastStosb -jar
```

尝试在客户端使用
```
-XX:ReservedCodeCacheSize=256M
```

```
-XX:+UnlockExperimentalVMOptions -XX:+UseShenandoahGC -XX:ShenandoahGCMode=iu -XX:+AlwaysPreTouch -XX:+UseLargePages -XX:+PerfDisableSharedMem -XX:+ParallelRefProcEnabled -XX:+DisableExplicitGC -XX:+UseNUMA -XX:ReservedCodeCacheSize=256M -XX:MaxInlineSize=256 -XX:+SegmentedCodeCache -XX:-DontCompileHugeMethods -XX:+OmitStackTraceInFastThrow -XX:ThreadPriorityPolicy=1 -XX:+TrustFinalNonStaticFields -XX:+UseFastUnorderedTimeStamps -XX:+UseXmmI2D -XX:+UseXmmI2F -XX:UseAVX=3 --add-modules=jdk.incubator.vector -XX:+UseVectorCmov -XX:+UseNewLongLShift -XX:+UseFastStosb
```

</details>
